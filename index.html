<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Al Ajamy Food | Invoice Tracker</title>

  <!-- Favicons (from your logo) -->
  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="favicon-32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="favicon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="favicon-180.png">
  <meta name="theme-color" content="#5B9F8A">

  <style>
    :root{--teal:#5B9F8A;--dark:#27433A;--accent:#F0A352;--bg:#F7FBFF;--card:#fff;--b:#e2e8f0;--muted:#64748b}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#0f172a;
      background:
        radial-gradient(1100px 520px at 18% 10%, color-mix(in srgb, var(--teal) 22%, transparent), transparent 62%),
        radial-gradient(900px 520px at 70% 85%, color-mix(in srgb, var(--accent) 14%, transparent), transparent 60%),
        linear-gradient(135deg,#F7FBFF,#F3FFF8);
      min-height:100vh}
    .header{position:sticky;top:0;z-index:5;backdrop-filter:blur(10px);background:color-mix(in srgb,#fff 70%,transparent);border-bottom:1px solid color-mix(in srgb,var(--b) 70%,transparent)}
    .header-inner{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;justify-content:center}
    .brand{display:flex;align-items:center;gap:12px;padding:10px 16px;border-radius:18px;background:linear-gradient(135deg,color-mix(in srgb,var(--teal) 12%,#fff),color-mix(in srgb,var(--accent) 10%,#fff));border:1px solid color-mix(in srgb,var(--b) 85%,transparent);box-shadow:0 12px 30px rgba(2,6,23,.08)}
    .brand img{width:76px;height:56px;object-fit:contain;border-radius:16px;background:#fff;padding:8px;border:1px solid color-mix(in srgb,var(--b) 85%,transparent)}
    .brand b{display:block;color:#162621;font-size:16px;line-height:1.1}
    .brand span{display:block;color:var(--muted);font-size:12px;margin-top:3px}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .card{background:var(--card);border:1px solid color-mix(in srgb,var(--b) 90%,transparent);border-radius:18px;box-shadow:0 12px 30px rgba(2,6,23,.08);overflow:hidden}
    .card-head{padding:14px 16px;background:linear-gradient(135deg,color-mix(in srgb,var(--teal) 14%,#fff),color-mix(in srgb,var(--accent) 10%,#fff));border-bottom:1px solid color-mix(in srgb,var(--b) 85%,transparent)}
    .card-head h3{margin:0;font-size:16px;color:#162621}
    .card-head p{margin:6px 0 0;color:var(--muted);font-size:13px}
    .grid{display:flex;flex-wrap:wrap;gap:12px;padding:14px 16px 4px}
    .field{flex:1 1 200px;min-width:180px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,textarea{width:100%;border:1px solid var(--b);border-radius:12px;padding:10px 12px;font:inherit;background:#fff;outline:none}
    input{height:40px}
    textarea{min-height:42px;resize:vertical}
    input:focus,textarea:focus{border-color:color-mix(in srgb,var(--teal) 70%,var(--b));box-shadow:0 0 0 4px color-mix(in srgb,var(--teal) 18%,transparent)}
    table{width:100%;border-collapse:collapse}
    th,td{border-top:1px solid var(--b);padding:10px 12px;text-align:right;vertical-align:middle}
    thead th{border-top:none;background:#fbfdff;color:var(--muted);font-size:12px}
    tfoot td{background:#fbfdff;font-weight:700}
    .qty,.price{width:130px;height:36px;border-radius:10px;padding:8px 10px}
    .disabled{background:#f1f5f9 !important;color:#94a3b8;cursor:not-allowed}
    input[type=checkbox]{width:18px;height:18px;accent-color:var(--teal);cursor:pointer}
    .actions{display:flex;gap:10px;flex-wrap:wrap;padding:0 16px 16px}
    button{border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .primary{color:#fff;background:linear-gradient(135deg,var(--teal),color-mix(in srgb,var(--teal) 60%,#80B030));box-shadow:0 10px 22px rgba(2,6,23,.10)}
    .secondary{background:#fff;border:1px solid var(--b);color:#162621}
    .note{padding:0 16px 16px;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="header">
    <div class="header-inner">
      <div class="brand">
        <img src="logo.png" alt="Al Ajamy Food Logo" />
        <div>
          <b>Al Ajamy Food | العجمي</b>
          <span>Invoice Tracker — فعّل الصنف بالتيك ثم أدخل الكمية والسعر</span>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="card-head">
        <h3>إدخال الفاتورة</h3>
        <p>الحقول (الكمية/السعر) لا تعمل إلا بعد تفعيل الصنف.</p>
      </div>

      <div class="grid">
        <div class="field"><label>رقم الفاتورة</label><input id="invoiceNo" placeholder="مثال: INV-001" /></div>
        <div class="field"><label>التاريخ</label><input id="date" type="date" /></div>
        <div class="field"><label>الزبون</label><input id="customer" placeholder="اسم الزبون" /></div>
        <div class="field"><label>From</label><input id="from" placeholder="المصدر" /></div>
        <div class="field"><label>To</label><input id="to" placeholder="الوجهة" /></div>
      </div>

      <table id="items">
        <thead>
          <tr>
            <th style="width:80px">اختيار</th>
            <th>الصنف</th>
            <th style="width:150px">الكمية</th>
            <th style="width:150px">سعر الوحدة</th>
            <th style="width:150px">الإجمالي</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="4" style="text-align:left">المجموع</td>
            <td><span id="grandTotal">0.00</span></td>
          </tr>
        </tfoot>
      </table>

      <div class="grid">
        <div class="field" style="flex:1 1 420px"><label>Details</label><textarea id="details" placeholder="تفاصيل إضافية..."></textarea></div>
        <div class="field" style="flex:1 1 420px"><label>Comments</label><textarea id="comments" placeholder="ملاحظات..."></textarea></div>
      </div>

      <div class="actions">
        <button class="primary" id="exportJsonBtn" type="button">تصدير JSON</button>
        <button class="secondary" id="resetBtn" type="button">مسح النموذج</button>
      </div>
      <div class="note">"تصدير JSON" يعطيك ملف جاهز لإرساله لـ API/قاعدة بيانات لاحقاً.</div>
    </div>
  </div>

  <script>
    const products = [
      "Garlic Sauce/كريم الثوم",
      "Hummus Alajamy /حمص العجمي",
      "Hummus Large boxes /حمص علب كبار",
      "Hummus Small boxes /حمص علب صغار",
      "Hummus Zad Al-Arabi /حمص زاد العربي",
      "Hummus Al-Nuzha /حمص النزهة",
      "Hummus Al-Khal /حمص الخال",
      "Mutabal /متبل",
      "Labneh /لبنة"
    ];

    const tbody = document.querySelector('#items tbody');
    const grandTotalEl = document.getElementById('grandTotal');

    function recalc(){
      let sum=0;
      tbody.querySelectorAll('tr').forEach(tr=>{
        const cb = tr.querySelector('input[type=checkbox]');
        const qty = tr.querySelector('.qty');
        const price = tr.querySelector('.price');
        const totalEl = tr.querySelector('.lineTotal');
        let line=0;
        if(cb.checked){
          const q = Number(qty.value||0);
          const p = Number(price.value||0);
          line = q*p;
        }
        totalEl.textContent = line.toFixed(2);
        sum += line;
      });
      grandTotalEl.textContent = sum.toFixed(2);
    }

    function setEnabled(tr, enabled){
      const qty = tr.querySelector('.qty');
      const price = tr.querySelector('.price');
      qty.disabled = !enabled; price.disabled = !enabled;
      qty.classList.toggle('disabled', !enabled);
      price.classList.toggle('disabled', !enabled);
      if(!enabled){ qty.value=''; price.value=''; }
      recalc();
    }

    function buildRows(){
      tbody.innerHTML='';
      products.forEach(name=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="checkbox"></td>
          <td>${name}</td>
          <td><input class="qty disabled" type="number" min="0" step="1" disabled></td>
          <td><input class="price disabled" type="number" min="0" step="0.01" disabled></td>
          <td class="lineTotal">0.00</td>
        `;
        const cb = tr.querySelector('input[type=checkbox]');
        cb.addEventListener('change', ()=>setEnabled(tr, cb.checked));
        tr.querySelectorAll('input[type=number]').forEach(inp=>inp.addEventListener('input', recalc));
        tbody.appendChild(tr);
      });
    }

    function collectData(){
      const items=[];
      tbody.querySelectorAll('tr').forEach(tr=>{
        const checked = tr.querySelector('input[type=checkbox]').checked;
        if(!checked) return;
        const product = tr.children[1].textContent.trim();
        const qty = Number(tr.querySelector('.qty').value||0);
        const unitPrice = Number(tr.querySelector('.price').value||0);
        items.push({product, qty, unitPrice, total: Number((qty*unitPrice).toFixed(2))});
      });
      return {
        invoiceNo: document.getElementById('invoiceNo').value.trim(),
        date: document.getElementById('date').value,
        customer: document.getElementById('customer').value.trim(),
        from: document.getElementById('from').value.trim(),
        to: document.getElementById('to').value.trim(),
        details: document.getElementById('details').value.trim(),
        comments: document.getElementById('comments').value.trim(),
        items,
        grandTotal: Number(grandTotalEl.textContent||0)
      };
    }

    function downloadJson(data){
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const safeNo = (data.invoiceNo || 'invoice').replace(/[^\w\-]+/g,'_');
      a.download = `${safeNo}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function resetForm(){
      ['invoiceNo','date','customer','from','to','details','comments'].forEach(id=>document.getElementById(id).value='');
      tbody.querySelectorAll('tr').forEach(tr=>{tr.querySelector('input[type=checkbox]').checked=false; setEnabled(tr,false);});
      recalc();
    }

    document.getElementById('exportJsonBtn').addEventListener('click', ()=>downloadJson(collectData()));
    document.getElementById('resetBtn').addEventListener('click', resetForm);

    buildRows();
    recalc();
  </script>
</body>
</html>
